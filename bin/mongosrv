#!/usr/bin/env node
// Generated by LiveScript 1.4.0
(function(){
  var existsSync, ref$, exec, which, yamlfile, mkdirp, optionator, option_parser, options, portnum, mongodir, hostname, new_mongodir;
  existsSync = require('fs').existsSync;
  ref$ = require('shelljs'), exec = ref$.exec, which = ref$.which;
  yamlfile = require('yamlfile');
  mkdirp = require('mkdirp');
  optionator = require('optionator');
  option_parser = optionator({
    options: [
      {
        option: 'port',
        alias: 'p',
        type: 'Int',
        description: 'port number',
        'default': '27017'
      }, {
        option: 'dbpath',
        alias: 'd',
        type: 'String',
        description: 'path to mongodata directory',
        'default': 'mongodata'
      }, {
        option: 'help',
        alias: 'h',
        type: 'Boolean',
        description: 'display help'
      }
    ]
  });
  options = option_parser.parseArgv(process.argv);
  if (options.help != null) {
    console.log(option_parser.generateHelp());
    process.exit();
  }
  portnum = options.port;
  mongodir = options.dbpath;
  if (!which('mongod')) {
    console.log('missing mongod command');
    process.exit();
  }
  if (existsSync('.mongosrv.yaml')) {
    hostname = exec('hostname').output.trim();
    new_mongodir = yamlfile.readFileSync('.mongosrv.yaml')[hostname];
    if (new_mongodir != null) {
      mongodir = new_mongodir;
    }
  }
  if (!existsSync(mongodir)) {
    console.log('creating mongodata directory');
    mkdirp.sync(mongodir);
  }
  exec("mongod --dbpath " + mongodir + " --port " + portnum, {
    async: true
  });
}).call(this);
